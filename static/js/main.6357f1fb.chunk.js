(this.webpackJsonpchatty=this.webpackJsonpchatty||[]).push([[0],{191:function(e,t,n){e.exports=n(245)},232:function(e,t,n){},233:function(e,t,n){},234:function(e,t,n){},245:function(e,t,n){"use strict";n.r(t);var a=n(0),r=n.n(a),o=n(16),c=n.n(o),s=n(298),l=n(111),i=n.n(l)()({palette:{type:"dark",primary:{light:"#6fbf73",main:"#357a38",dark:"#357a38"},secondary:{light:"#33eaff",main:"#00e5ff",dark:"#00a0b2"}},typography:{useNextVariants:!0}}),u=n(307),d=n(8),p=n(299),m=n(300),f=n(286),b=n(153),h=n.n(b),g=n(285),v=n(40),w=n(167),O=n(284),E=n(7),x=n.n(E),y=n(14),j=n(276),k=n(278),C=n(279),S=n(283),T=n(305),P=r.a.createContext({}),N=r.a.createContext({});var I=function(e){var t=e.open,n=e.onClose,o=Object(a.useState)(""),c=Object(d.a)(o,2),s=c[0],l=c[1],i=Object(a.useState)(""),u=Object(d.a)(i,2),p=u[0],m=u[1],f=Object(a.useContext)(P).login,b=Object(a.useContext)(N).setLoading,h=function(){var e=Object(y.a)(x.a.mark((function e(t){return x.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.preventDefault(),e.prev=1,b("sync"),e.next=5,f(s,p);case 5:n();case 6:return e.prev=6,b(!1),e.finish(6);case 9:case"end":return e.stop()}}),e,null,[[1,,6,9]])})));return function(t){return e.apply(this,arguments)}}();return r.a.createElement(j.a,{open:t,onClose:n},r.a.createElement("form",{onSubmit:h},r.a.createElement(k.a,null,"Log in"),r.a.createElement(C.a,null,r.a.createElement(T.a,{autoFocus:!0,margin:"dense",label:"Username",type:"text",fullWidth:!0,onChange:function(e){return l(e.target.value)}}),r.a.createElement(T.a,{margin:"dense",label:"Password",type:"password",fullWidth:!0,onChange:function(e){return m(e.target.value)}})),r.a.createElement(S.a,null,r.a.createElement(O.a,{onClick:n},"Cancel"),r.a.createElement(O.a,{type:"submit"},"Log in"))))};var F=function(){var e=Object(a.useState)(!1),t=Object(d.a)(e,2),n=t[0],o=t[1];return r.a.createElement(r.a.Fragment,null,r.a.createElement(O.a,{onClick:function(){return o(!0)}},"Log in"),r.a.createElement(I,{open:n,onClose:function(){return o(!1)}}))};var R=function(e){var t=e.onClick,n=Object(a.useContext)(P).logout;return r.a.createElement(g.a,{onClick:function(){t&&t(),n()}},"Logout")},L=n(287),B=n(146),D=n.n(B);var M=function(){var e=Object(a.useContext)(P),t=e.isLoggedIn,n=e.username,o=Object(a.useState)(null),c=Object(d.a)(o,2),s=c[0],l=c[1];return t?r.a.createElement(r.a.Fragment,null,r.a.createElement(f.a,{size:"small",onClick:function(e){return l(e.target)}},r.a.createElement(D.a,null)),s&&r.a.createElement(w.a,{keepMounted:!0,open:!!s,anchorEl:s,onClose:function(){return l(null)}},r.a.createElement(g.a,{disabled:!0},n),r.a.createElement(L.a,null),r.a.createElement(R,{onClick:function(){return l(null)}}))):r.a.createElement(F,null)},U=n(309),z=n(117),W=n.n(z),H=n(288),_=r.a.createContext({}),V=n(252);var J=Object(V.a)({badge:{}}),A=function(){var e=J(),t=Object(a.useContext)(_),n=t.newThreads,o=t.refreshChatty,c=n&&n.length>0,s=c?"Refresh Thread Order (".concat(n.length," new threads)"):"Refresh Thread Order",l=function(){var e=Object(y.a)(x.a.mark((function e(){return x.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,o();case 2:window.scrollTo(0,0);case 3:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return r.a.createElement(U.a,{disableFocusListener:!0,title:s,enterDelay:350},r.a.createElement(f.a,{size:"small",onClick:l},c?r.a.createElement(H.a,{color:"secondary",classes:{badge:e.badge},variant:"dot",anchorOrigin:{vertical:"top",horizontal:"left"}},r.a.createElement(W.a,null)):r.a.createElement(W.a,null)))},q=n(94),K=n.n(q),G=n(289),Q=n(290),X=n(292),Y=n(291),Z=n(280),$=n(19),ee=n(93),te=n.n(ee),ne=function(){var e=Object(y.a)(x.a.mark((function e(t,n){return x.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",ae("".concat("https://winchatty.com/v2","/").concat(t),n));case 1:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),ae=function(){var e=Object(y.a)(x.a.mark((function e(t){var n,a,r,o,c,s,l=arguments;return x.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(n=l.length>1&&void 0!==l[1]?l[1]:{}).body&&(n=Object($.a)({},n,{headers:Object($.a)({"Content-Type":"application/x-www-form-urlencoded"},n.headers),body:te.a.stringify(n.body)})),e.next=4,fetch(t,n);case 4:if(!(a=e.sent).ok){e.next=11;break}return e.next=8,re(a);case 8:return e.abrupt("return",e.sent);case 11:return e.next=13,re(a);case 13:return r=e.sent,o=a.status,c=a.statusText,s={status:o,statusText:c,body:r},console.error("Http Error:",s),e.abrupt("return",Promise.reject(s));case 18:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),re=function(){var e=Object(y.a)(x.a.mark((function e(t){var n;return x.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.text();case 2:return n=e.sent,e.prev=3,e.abrupt("return",JSON.parse(n));case 7:return e.prev=7,e.t0=e.catch(3),e.abrupt("return",n);case 10:case"end":return e.stop()}}),e,null,[[3,7]])})));return function(t){return e.apply(this,arguments)}}(),oe=n(23),ce=n.n(oe);var se=Object(V.a)({card:{backgroundColor:"#202224",borderRadius:0,border:"1px solid #656565"},actions:{margin:"-8px 0 8px 8px"},flexRow:{display:"flex",flexDirection:"row"},textarea:{flex:1,backgroundColor:"#000",padding:4}}),le=function(e){var t=e.onCloseReplyBox,n=e.parentId,o=e.className,c=se(),s=Object(a.useContext)(P),l=s.username,i=s.password,u=Object(a.useContext)(N),p=u.setLoading,m=u.showSnackbar,f=Object(a.useState)(""),b=Object(d.a)(f,2),h=b[0],g=b[1],v=Object(a.useState)(!1),w=Object(d.a)(v,2),E=w[0],j=w[1],k=function(){var e=Object(y.a)(x.a.mark((function e(){return x.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,p("async"),j(!0),e.next=5,ne("postComment",{method:"POST",body:{username:l,password:i,parentId:n,text:h}});case 5:"success"===e.sent.result&&t(),e.next=14;break;case 9:e.prev=9,e.t0=e.catch(0),console.log("Error while posting comment",e.t0),m("Error while posting. Please try again later.",{variant:"error"}),j(!1);case 14:return e.prev=14,p(!1),e.finish(14);case 17:case"end":return e.stop()}}),e,null,[[0,9,14,17]])})));return function(){return e.apply(this,arguments)}}();return r.a.createElement(G.a,{className:ce()(o,c.card)},0===n&&r.a.createElement(Q.a,{title:"New Thread"}),r.a.createElement(Y.a,null,r.a.createElement("div",{className:c.flexRow},r.a.createElement(Z.a,{multiline:!0,autoFocus:!0,disableUnderline:!0,rows:5,fullWidth:!0,className:c.textarea,placeholder:"Type something interesting...",name:"replyBody",required:!0,disabled:E,onChange:function(e){return g(e.target.value)}}))),r.a.createElement(X.a,{className:c.actions},r.a.createElement(O.a,{color:"primary",variant:"outlined",disabled:E||!h.length,onClick:k},"Post"),r.a.createElement(O.a,{variant:"outlined",disabled:E,onClick:t},"Cancel")))};var ie=Object(V.a)({dialogPaper:{width:"85vw"}}),ue=function(){var e=ie(),t=Object(a.useContext)(P).isLoggedIn,n=Object(a.useState)(!1),o=Object(d.a)(n,2),c=o[0],s=o[1];return t?r.a.createElement(r.a.Fragment,null,r.a.createElement(U.a,{disableFocusListener:!0,title:"New Thread",enterDelay:350},r.a.createElement(f.a,{size:"small",onClick:function(){return s(!0)}},r.a.createElement(K.a,null))),r.a.createElement(j.a,{open:c,onClose:function(){return s(!1)},classes:{paper:e.dialogPaper}},r.a.createElement(le,{parentId:0,onCloseReplyBox:function(){return s(!1)}}))):null},de=n(118),pe=n.n(de);var me=Object(V.a)({badge:{top:12}}),fe=function(){var e=me(),t=Object(a.useContext)(P),n=t.isLoggedIn,o=t.username,c=t.password,s=Object(a.useState)(0),l=Object(d.a)(s,2),i=l[0],u=l[1],p=Object(a.useState)(0),m=Object(d.a)(p,2),b=m[0],h=m[1],g=b>0,v="( ".concat(b," / ").concat(i," ) unread messages");return Object(a.useEffect)((function(){var e=function(){var e=Object(y.a)(x.a.mark((function e(){var t,a,r,s;return x.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!n){e.next=9;break}return t={method:"POST",body:{username:o,password:c}},e.next=4,ne("getMessageCount",t);case 4:a=e.sent,r=a.total,s=a.unread,u(r),h(s);case 9:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();e();var t=setInterval((function(){return e()}),9e5);return function(){return clearInterval(t)}}),[n,c,o]),n?r.a.createElement(U.a,{disableFocusListener:!0,title:v,enterDelay:350},r.a.createElement(f.a,{size:"small",href:"https://www.shacknews.com/messages",target:"_blank"},g?r.a.createElement(H.a,{badgeContent:b,color:"secondary",classes:{badge:e.badge}},r.a.createElement(pe.a,null)):r.a.createElement(pe.a,null))):null},be=n(151),he=n.n(be),ge=n(152),ve=n.n(ge),we=n(150),Oe=n.n(we),Ee=r.a.createContext({}),xe=n(282),ye=n(251),je=n(294),ke=n(293),Ce=n(149),Se=n.n(Ce),Te=n(148),Pe=n.n(Te),Ne=n(95),Ie=n.n(Ne);var Fe=Object(V.a)({row:{display:"flex",flexDirection:"row"},fill:{display:"flex",flex:1},container:{marginTop:12},title:{marginTop:6}}),Re=function(e){var t=e.title,n=e.value,o=e.onChange,c=Fe(),s=Object(a.useState)(!1),l=Object(d.a)(s,2),i=l[0],u=l[1],p=Object(a.useState)(""),m=Object(d.a)(p,2),b=m[0],h=m[1],g=Object(a.useContext)(N).showSnackbar,w=function(){try{if(b.length){var e=new RegExp(b,"gmi"),t={text:b,regex:e};o&&o(n.concat([t])),u(!1),h("")}}catch(a){g("Invalid filter term.",{variant:"error"}),console.error("Error processing new filter value",b,a)}};return r.a.createElement("div",{className:c.container},r.a.createElement("div",{className:c.row},i?r.a.createElement(r.a.Fragment,null,r.a.createElement(T.a,{placeholder:"Add new ".concat(t.toLowerCase()),margin:"none",autoFocus:!0,className:c.fill,value:b,onKeyPress:function(e){return"Enter"===e.key&&w()},onChange:function(e){return h(e.target.value)}}),r.a.createElement(f.a,{onClick:function(){return w()}},r.a.createElement(Pe.a,{fontSize:"small"})),r.a.createElement(f.a,{onClick:function(){return u(!1)}},r.a.createElement(Ie.a,{fontSize:"small"}))):r.a.createElement(r.a.Fragment,null,r.a.createElement(v.a,{variant:"subtitle1",className:ce()(c.title,c.fill)},t,"s"),r.a.createElement(f.a,{disableRipple:!0,onClick:function(){return u(!0)}},r.a.createElement(K.a,{fontSize:"small"})))),r.a.createElement(xe.a,{dense:!0},0===n.length&&r.a.createElement(ye.a,{dense:!0},r.a.createElement(ke.a,{primary:"List is empty."})),n.length>0&&n.map((function(e,t){return r.a.createElement(ye.a,{key:t,dense:!0},r.a.createElement(ke.a,{primary:e.text}),r.a.createElement(je.a,null,r.a.createElement(f.a,{onClick:function(){return t=e,o&&o(n.filter((function(e){return e!==t})));var t}},r.a.createElement(Se.a,{fontSize:"small"}))))}))))},Le=n(306),Be=n(295);var De=Object(V.a)({checkbox:{marginBottom:-12}}),Me=function(e){var t=e.label,n=e.checked,a=e.onChange,o=De();return r.a.createElement(Be.a,{label:t,className:o.checkbox,control:r.a.createElement(Le.a,{checked:n,onChange:a})})};var Ue=Object(V.a)({content:{display:"flex",flexDirection:"column",width:300},checkboxes:{marginTop:12}}),ze=function(e){var t=e.open,n=e.onClose,o=Ue(),c=Object(a.useContext)(Ee),s=c.filterSettings,l=c.updateFilterSettings,i=Object(a.useContext)(N).setLoading,u=Object(a.useState)(s.showCollapsed),p=Object(d.a)(u,2),m=p[0],f=p[1],b=Object(a.useState)(s.showFilteredTerms),h=Object(d.a)(b,2),g=h[0],w=h[1],E=Object(a.useState)(s.showFilteredUsers),T=Object(d.a)(E,2),P=T[0],I=T[1],F=Object(a.useState)(s.showNotWorkSafePosts),R=Object(d.a)(F,2),L=R[0],B=R[1],D=Object(a.useState)(s.showStupidPosts),M=Object(d.a)(D,2),U=M[0],z=M[1],W=Object(a.useState)(s.showOfftopicPosts),H=Object(d.a)(W,2),_=H[0],V=H[1],J=Object(a.useState)(s.showPoliticalReligiousPosts),A=Object(d.a)(J,2),q=A[0],K=A[1],G=Object(a.useState)(s.showCortexPosts),Q=Object(d.a)(G,2),X=Q[0],Y=Q[1],Z=Object(a.useState)(s.filteredTerms),$=Object(d.a)(Z,2),ee=$[0],te=$[1],ne=Object(a.useState)(s.filteredUsers),ae=Object(d.a)(ne,2),re=ae[0],oe=ae[1],ce=function(){var e=Object(y.a)(x.a.mark((function e(){return x.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,i("sync"),e.next=4,l({showCollapsed:m,showFilteredTerms:g,showFilteredUsers:P,showNotWorkSafePosts:L,showStupidPosts:U,showOfftopicPosts:_,showPoliticalReligiousPosts:q,showCortexPosts:X,filteredTerms:ee,filteredUsers:re});case 4:n();case 5:return e.prev=5,i(!1),e.finish(5);case 8:case"end":return e.stop()}}),e,null,[[0,,5,8]])})));return function(){return e.apply(this,arguments)}}();return r.a.createElement(j.a,{open:t,onClose:n},r.a.createElement(k.a,null,"Filter Settings"),r.a.createElement(C.a,{className:o.content},r.a.createElement(v.a,{variant:"caption",color:"textSecondary"},"These settings adjust what posts display in the chatty. Filtered keywords will hide any posts that match. Filtered users will hide any posts or replies by that user. Terms support full regular expressions. Checking a checkbox will show posts even if they match that criteria."),r.a.createElement(Re,{title:"Term",value:ee,onChange:function(e){return te(e)}}),r.a.createElement(Re,{title:"User",value:re,onChange:function(e){return oe(e)}}),r.a.createElement("div",{className:o.checkboxes},r.a.createElement(Me,{label:"Show Not Work Safe Posts",checked:L,onChange:function(){return B(!L)}}),r.a.createElement(Me,{label:"Show Stupid Posts",checked:U,onChange:function(){return z(!U)}}),r.a.createElement(Me,{label:"Show Offtopic Posts",checked:_,onChange:function(){return V(!_)}}),r.a.createElement(Me,{label:"Show Political / Religious Posts",checked:q,onChange:function(){return K(!q)}}),r.a.createElement(Me,{label:"Show Cortex Posts",checked:X,onChange:function(){return Y(!X)}})),r.a.createElement("div",{className:o.checkboxes},r.a.createElement(Me,{label:"Show Collapsed Threads/Posts",checked:m,onChange:function(){return f(!m)}}),r.a.createElement(Me,{label:"Show Filtered Terms",checked:g,onChange:function(){return w(!g)}}),r.a.createElement(Me,{label:"Show Filtered Users",checked:P,onChange:function(){return I(!P)}}))),r.a.createElement(S.a,null,r.a.createElement(O.a,{onClick:n},"Cancel"),r.a.createElement(O.a,{onClick:ce},"Save")))};var We=function(){var e=Object(a.useState)(!1),t=Object(d.a)(e,2),n=t[0],o=t[1],c=Object(a.useState)(!1),s=Object(d.a)(c,2),l=s[0],i=s[1];return r.a.createElement(r.a.Fragment,null,r.a.createElement(Oe.a,{disableFocusListener:!0,title:"Filter Settings",enterDelay:350},r.a.createElement(he.a,{size:"small",onClick:function(){return o(!0)||i(!0)}},r.a.createElement(ve.a,null))),l&&r.a.createElement(ze,{open:n,onClose:function(){return o(!1)}}))},He=n(301);var _e=Object(V.a)({appBar:{paddingRight:8},white:{color:"#fff"},title:{color:"#fff",flex:1},menuButton:{marginLeft:-15,marginRight:8},menuItem:{textDecoration:"none",color:"inherit"}}),Ve=function(){var e=_e(),t=Object(a.useState)(!1),n=Object(d.a)(t,2),o=n[0],c=n[1],s=function(){return c(!1)};return r.a.createElement(r.a.Fragment,null,r.a.createElement(p.a,{elevation:0},r.a.createElement(m.a,{variant:"dense",className:e.appBar},r.a.createElement(f.a,{size:"small",className:e.menuButton,onClick:function(){return c(!o)}},r.a.createElement(h.a,{className:e.white})),r.a.createElement(v.a,{variant:"h5",className:e.title},"Chatty"),r.a.createElement(A,null),r.a.createElement(ue,null),r.a.createElement(We,null),r.a.createElement(fe,null),r.a.createElement(M,null))),r.a.createElement(He.a,{open:o,onClose:s,className:e.drawer},r.a.createElement(p.a,{position:"static",color:"primary",className:e.drawerAppBar},r.a.createElement(m.a,{variant:"dense"},r.a.createElement(v.a,{variant:"h6",className:e.title},"Latest Chatty"))),r.a.createElement("a",{href:"https://github.com/latestchatty/chatty",target:"_blank",rel:"noopener noreferrer",className:e.menuItem},r.a.createElement(g.a,{onClick:s},"Contribute")),r.a.createElement("a",{href:"https://github.com/latestchatty/chatty/issues",target:"_blank",rel:"noopener noreferrer",className:e.menuItem},r.a.createElement(g.a,{onClick:s},"Feedback"))))},Je=n(51),Ae=n(159),qe=n.n(Ae),Ke=n(160),Ge=n.n(Ke),Qe=n(161),Xe=n.n(Qe),Ye=n(158),Ze=n.n(Ye);var $e=Object(V.a)({wrapper:{height:8,width:48,margin:7,background:"rgb(221, 221, 221) -webkit-gradient(\n                linear,\n                0% 0%,\n                0% 100%,\n                from(rgb(170, 170, 170)),\n                color-stop(0.4, rgb(204, 204, 204)),\n                color-stop(0.6, rgb(204, 204, 204)),\n                to(rgb(238, 238, 238))\n            )"},value:{height:8,backgroundImage:"-webkit-gradient(\n                linear,\n                0 100%,\n                100% 0,\n                color-stop(0.25, rgba(255, 255, 255, 0.4)),\n                color-stop(0.25, transparent),\n                color-stop(0.5, transparent),\n                color-stop(0.5, rgba(255, 255, 255, 0.4)),\n                color-stop(0.75, rgba(255, 255, 255, 0.4)),\n                color-stop(0.75, transparent),\n                to(transparent)\n            )",backgroundSize:"25px 25px",boxShadow:"rgba(255, 255, 255, 0.298039) 0 2px 4px inset, rgba(0, 0, 0, 0.4) 0 -2px 3px inset"}}),et=function(e){var t=e.date,n=$e(),a=(new Date).getTime(),o=new Date(t).getTime(),c=Math.min((a-o)/36e5/18*100,100),s="red";return c<=25?s="springgreen":c<=50?s="yellow":c<=75&&(s="orange"),r.a.createElement("div",{className:n.wrapper},r.a.createElement("div",{className:n.value,style:{width:"".concat(c,"%"),backgroundColor:s}}))},tt=n(164),nt=n(165),at=n(96);var rt=Object(V.a)({date:{fontSize:10,color:"#888",paddingTop:3,marginRight:3}}),ot=function(e){var t=e.date,n=rt(),a=Object(at.a)(t);return r.a.createElement(U.a,{disableFocusListener:!0,title:Object(tt.a)(a,"MMM dd, yyyy h:mma"),enterDelay:350},r.a.createElement("div",{className:n.date},Object(nt.a)(a)," ago"))};var ct=["themanwiththebriefcase","shacknews"],st=[],lt=Object(V.a)({user:{fontSize:14,fontWeight:"bold",cursor:"pointer","&:hover":{textDecoration:"underline"}},normal:{color:"#f3e7b5"},self:{color:"#6cf"},op:{color:"#6aff94"},mod:{color:"#d20000"},employee:{color:"#9370db"}}),it=function(e){var t=e.post,n=void 0===t?{}:t,o=e.thread,c=void 0===o?{}:o,s=lt(),l=Object(a.useContext)(P).username,i=n.author,u=void 0===i?"":i,d=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",n=e.toLowerCase().replace(/\s/g,""),a=t.toLowerCase().replace(/\s/g,"");return n===a},p=Object(a.useMemo)((function(){return l&&d(u,l)?"self":c.id!==n.id&&d(c.author,u)?"op":ct.find((function(e){return d(e,u)}))?"employee":st.find((function(e){return d(e,u)}))?"mod":"normal"}),[l,u,c.id,n.id,c.author]),m=Object(a.useMemo)((function(){return u.replace(/\s/g,String.fromCharCode(160))}),[u]);return r.a.createElement("span",{className:ce()(s.user,s[p])},m)},ut=n(76),dt=n(310),pt=["lol","inf","unf","tag","wtf","wow","aww"],mt={1:"lol",2:"inf",3:"unf",4:"tag",5:"wtf",6:"wow",7:"aww"},ft={lol:"#f80",inf:"#09c",unf:"#eb0000",tag:"#7b2",wtf:"#c000c0",wow:"#c4a3b3",aww:"#13a4a7"};var bt=Object(V.a)({containerPost:{marginLeft:12},containerOneline:{marginLeft:4,whiteSpace:"nowrap"},chip:{height:16,marginTop:2,marginRight:6,fontSize:10},nonChip:{marginRight:4,fontSize:9}}),ht=function(e){var t=e.tags,n=void 0===t?[]:t,o=e.variant,c=bt(),s=Object(a.useMemo)((function(){var e=n.filter((function(e){return pt.includes(e.tag)})),t=n.filter((function(e){return!pt.includes(e.tag)})).reduce((function(e,t){return e+t.count}),0);return[].concat(Object(ut.a)(e),[{tag:"tag",count:t}])}),[n]);return r.a.createElement("div",{className:"post"===o?c.containerPost:c.containerOneline},s.map((function(e){var t=e.tag,n=e.count;return n<1?null:"post"===o?r.a.createElement(dt.a,{key:t,className:c.chip,style:{color:ft[t],border:"1px solid ".concat(ft[t])},label:"".concat(n," ").concat(t),variant:"outlined"}):"oneline"===o?r.a.createElement("span",{key:t,className:c.nonChip,style:{color:ft[t]}},"".concat(n," ").concat(t)):null})))},gt=n(154),vt=n.n(gt);var wt=function(e){var t=e.className,n=e.postId,o=Object(a.useContext)(P),c=o.isLoggedIn,s=o.username,l=o.password,i=Object(a.useContext)(N),u=i.setLoading,p=i.showSnackbar,m=Object(a.useState)(null),f=Object(d.a)(m,2),b=f[0],h=f[1],v=pt.map((function(e){return e.toUpperCase()})),O=function(){var e=Object(y.a)(x.a.mark((function e(t){var a,r,o,c;return x.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,u("async"),h(null),e.next=5,E(s,n,t,"tag");case 5:if(a=e.sent,r=a.message,o=a.status,!r.includes("Already tagged")){e.next=13;break}return e.next=11,E(s,n,t,"untag");case 11:c=e.sent,o=c.status;case 13:"1"!==!o&&console.warn("Error tagging post",r),e.next=20;break;case 16:e.prev=16,e.t0=e.catch(0),console.error("Exception while tagging post",e.t0),p("Error while tagging post. Please try again later.",{variant:"error"});case 20:return e.prev=20,u(!1),e.finish(20);case 23:case"end":return e.stop()}}),e,null,[[0,16,20,23]])})));return function(t){return e.apply(this,arguments)}}(),E=function(){var e=Object(y.a)(x.a.mark((function e(t,n,a,r){var o;return x.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o={who:t,what:n,tag:a,password:l,action:r},e.abrupt("return",ne("lol",{method:"POST",body:o}));case 2:case"end":return e.stop()}}),e)})));return function(t,n,a,r){return e.apply(this,arguments)}}();return c?r.a.createElement(r.a.Fragment,null,r.a.createElement(U.a,{disableFocusListener:!0,title:"Tag Post",enterDelay:350},r.a.createElement(vt.a,{className:t,onClick:function(e){return h(e.target)}})),b&&r.a.createElement(w.a,{keepMounted:!0,open:!!b,anchorEl:b,onClose:function(){return h(null)}},v.map((function(e){return r.a.createElement(g.a,{key:e,onClick:function(){return O(e)}},e)})))):null};var Ot=function(e){var t=e.post,n=Object(a.useMemo)((function(){t.body;return"Shacknews"===t.author&&t.body.replace('href="/','href="https://www.shacknews.com/'),{__html:t.body.replace("<a href=",'<a target="_blank" rel="noopener noreferrer" href=')}}),[t.body,t.author]);return r.a.createElement("span",{dangerouslySetInnerHTML:n})},Et=n(156),xt=n.n(Et),yt=n(157),jt=n.n(yt),kt=n(155),Ct=n.n(kt),St=n(281),Tt=n(302);var Pt=Object(V.a)((function(e){return{button:{width:18,height:18,marginTop:1,cursor:"pointer",color:"#fff"},list:{width:"100%",maxWidth:400,backgroundColor:e.palette.background.paper,position:"relative",overflow:"auto",maxHeight:300},li:{backgroundColor:"inherit"},ul:{backgroundColor:"inherit",padding:0}}})),Nt=function(e){var t=e.post,n=Pt(),o=Object(a.useState)(null),c=Object(d.a)(o,2),s=c[0],l=c[1],i=Object(a.useState)({}),u=Object(d.a)(i,2),p=u[0],m=u[1],f=Object(a.useContext)(N),b=f.setLoading,h=f.showSnackbar,g=Object(a.useCallback)(function(){var e=Object(y.a)(x.a.mark((function e(n){var a,r,o;return x.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=n.currentTarget,h("This feature is under development, and will be available soon, check back later!.",{variant:"info"}),e.abrupt("return",null);case 4:return e.prev=4,b("async"),e.next=8,ne("getLolTaggers?id=".concat(t.id));case 8:r=e.sent,o=r.reduce((function(e,t){var n=t.tag,a=t.usernames;return e[mt[n]]=a,e}),{}),m(o),l(a),e.next=18;break;case 14:e.prev=14,e.t0=e.catch(4),console.error("Error while getting tagger names.",e.t0),h("Error while getting tagger names. Please try again later.",{variant:"error"});case 18:return e.prev=18,b(!1),e.finish(18);case 21:case"end":return e.stop()}}),e,null,[[4,14,18,21]])})));return function(t){return e.apply(this,arguments)}}(),[t.id,b,h]);return 0===t.lols.length?null:r.a.createElement(r.a.Fragment,null,r.a.createElement(U.a,{disableFocusListener:!0,title:"Who tagged this post?",enterDelay:350},r.a.createElement(Ct.a,{className:n.button,onClick:g})),s&&r.a.createElement(St.a,{open:!0,anchorEl:s,onClose:function(){return l(null)},anchorOrigin:{vertical:"bottom",horizontal:"center"},transformOrigin:{vertical:"top",horizontal:"center"}},r.a.createElement(xe.a,{className:n.list,subheader:r.a.createElement("li",null)},Object.keys(p).map((function(e){return r.a.createElement("li",{key:"section-".concat(e),className:n.li},r.a.createElement("ul",{className:n.ul},r.a.createElement(Tt.a,{className:n.bgColor,style:{color:ft[e]}},e),p[e].map((function(t){return r.a.createElement(ye.a,{key:"item-".concat(e,"-").concat(t)},r.a.createElement(ke.a,{primary:t}))}))))})))))};var It=Object(V.a)({card:{backgroundColor:"#202224",borderRadius:0,marginBottom:3},replyBorder:{border:"1px solid #656565"},replyBox:{marginTop:-3},tagNws:{borderLeft:"3px solid red !important"},tagInformative:{borderLeft:"3px solid #00bff3 !important"},tagFrontpage:{borderLeft:"3px solid mediumpurple !important"},content:{maxWidth:"calc(100vw - 32)",color:"lightgray",fontSize:13,padding:"8px 16px"},header:{backgroundColor:"#373a3c",padding:"3px 3px 3px 16px",display:"flex",flexDirection:"row"},actions:{height:34,padding:"0 8px 0 8px"},flex:{flex:1},toolbarButton:{width:18,height:18,cursor:"pointer",color:"#fff",marginRight:6},collapsed:{color:"#f00 !important"},pinned:{color:"#fcbf20 !important"}}),Ft=function(e){var t=e.post,n=e.thread,o=e.onCollapse,c=e.onHide,s=e.onPinned,l=e.replyBoxOpenForId,i=e.onOpenReplyBox,u=e.onCloseReplyBox,d=It(),p=Object(a.useRef)(null),m=Object(a.useContext)(P).isLoggedIn,f=Object(a.useContext)(Ee).isPostVisible,b=Object(a.useMemo)((function(){return"nuked"===t.category?null:"nws"===t.category?"tagNws":"informative"===t.category?"tagInformative":/shacknews/i.test(t.author)?"tagFrontpage":null}),[t.category,t.author]),h=t.parentId>0,g=n.id===t.id&&"collapsed"===t.markType,v=h?"replyBorder":null,w=function(){c(t),o()};return Object(a.useEffect)((function(){if(h){var e=p.current.getBoundingClientRect(),t=Math.max(document.documentElement.clientHeight,window.innerHeight),n=e.bottom<0,a=e.top-t>=0;n?window.scrollTo({left:0,top:p.current.offsetTop-75,behavior:"smooth"}):a&&window.scrollTo({left:0,top:p.current.offsetTop-t+e.height+24,behavior:"smooth"})}}),[h]),Object(a.useMemo)((function(){return f(n,t)}),[f,t,n])?r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{ref:p},r.a.createElement(G.a,{className:ce()(d.card,d[b],d[v])},r.a.createElement("div",{className:d.header},r.a.createElement(it,{post:t,thread:n}),r.a.createElement(ht,{tags:t.lols,variant:"post"}),r.a.createElement(Nt,{post:t}),r.a.createElement("span",{className:d.flex}),r.a.createElement(ot,{date:t.date}),0===t.parentId&&r.a.createElement(et,{date:t.date})),r.a.createElement(Y.a,{className:ce()("postbody",d.content)},r.a.createElement(Ot,{post:t})),r.a.createElement(X.a,{className:d.actions,disableSpacing:!0},r.a.createElement(U.a,{disableFocusListener:!0,title:g?"Uncollapse":"Collapse",enterDelay:350},r.a.createElement(Ie.a,{className:ce()(d.toolbarButton,g?d.collapsed:null),onClick:o})),n.id!==t.id&&"collapsed"!==t.markType&&r.a.createElement(U.a,{disableFocusListener:!0,title:"Hide",enterDelay:350},r.a.createElement(xt.a,{className:ce()(d.toolbarButton),onClick:w})),n.id!==t.id&&"collapsed"===t.markType&&r.a.createElement(U.a,{disableFocusListener:!0,title:"Unhide",enterDelay:350},r.a.createElement(jt.a,{className:ce()(d.toolbarButton,d.collapsed),onClick:w})),m&&r.a.createElement(U.a,{disableFocusListener:!0,title:"Reply",enterDelay:350},r.a.createElement(Ze.a,{className:d.toolbarButton,onClick:function(){return i(t.id)}})),m&&0===t.parentId&&r.a.createElement(r.a.Fragment,null,"pinned"===t.markType&&r.a.createElement(U.a,{disableFocusListener:!0,title:"Unpin Thread",enterDelay:350},r.a.createElement(qe.a,{className:ce()(d.toolbarButton,d.pinned),onClick:s})),"pinned"!==t.markType&&r.a.createElement(U.a,{disableFocusListener:!0,title:"Pin Thread",enterDelay:350},r.a.createElement(Ge.a,{className:d.toolbarButton,onClick:s}))),r.a.createElement(wt,{postId:t.id,className:d.toolbarButton}),r.a.createElement(U.a,{disableFocusListener:!0,title:"View Post @ Shacknews.com",enterDelay:350},r.a.createElement("a",{className:d.toolbarButton,target:"_blank",rel:"noopener noreferrer",href:"http://www.shacknews.com/chatty?id=".concat(t.id,"#item_").concat(t.id)},r.a.createElement(Xe.a,{className:d.toolbarButton})))))),l===t.id&&r.a.createElement(le,{parentId:t.id,onCloseReplyBox:u,className:d.replyBox})):null},Rt=function(e){return e.replace(/(<[^>]+>)/gm,"")};var Lt=Object(V.a)({container:{display:"flex",flexDirection:"row"},separator:{padding:"0 3px",fontSize:11,color:"#fff"},oneline:{whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis","&:hover":{color:"#fff",backgroundColor:"#233548",cursor:"pointer"}},oneline10:{color:"#777"},oneline9:{color:"#888"},oneline8:{color:"#999"},oneline7:{color:"#aaa"},oneline6:{color:"#bbb"},oneline5:{color:"#ccc"},oneline4:{color:"#ddd"},oneline3:{color:"#eee"},oneline2:{color:"#fff"},oneline1:{color:"#eee",fontWeight:"bold"}}),Bt=function(e){var t=e.post,n=e.thread,o=e.onExpandReply,c=Lt(),s=Object(a.useContext)(Ee).isPostVisible,l="oneline".concat(t.recentReplyNumber||9),i=Object(a.useMemo)((function(){return function(e){for(var t=function(e){return e.replace(/(<(?!span)(?!\/span)[^>]+>| tabindex="1")/gm," ")}(e),n=0,a=0,r=!1,o=!1;n<t.length&&a<106;)"<"===t[n]?r=!0:">"===t[n]?r=!1:"&"===t[n]?o=!0:""===t[n]&&o?(o=!1,a++):r||a++,n++;var c=t.slice(0,n).trim();return(n<t.length||!c)&&(c+="..."),c}(t.body)}),[t.body]);return Object(a.useMemo)((function(){return s(n,t)}),[s,t,n])?r.a.createElement("div",{className:c.container},r.a.createElement("span",{className:ce()(c.oneline,c[l]),dangerouslySetInnerHTML:{__html:i},onClick:function(){return o(t.id)}}),r.a.createElement(ht,{tags:t.lols,variant:"oneline"}),r.a.createElement(it,{post:t,thread:n})):null};var Dt=function e(t){var n=t.className,o=t.thread,c=void 0===o?{}:o,s=t.parent,l=void 0===s?c:s,i=t.onHide,u=t.onCollapseReply,d=t.onExpandReply,p=t.onOpenReplyBox,m=t.expandedReplyId,f=t.replyBoxOpenForId,b=t.onCloseReplyBox,h=Object(a.useContext)(Ee).isPostVisible,g=Object(a.useMemo)((function(){return c.posts.filter((function(e){return e.parentId===l.id})).filter((function(e){return h(c,e)}))}),[h,l.id,c]);return r.a.createElement("ul",{className:ce()("comments",n)},g.map((function(t){return r.a.createElement("li",{key:t.id},m===t.id?r.a.createElement(Ft,{post:t,thread:c,onHide:i,onCollapse:u,replyBoxOpenForId:f,onOpenReplyBox:p,onCloseReplyBox:b}):r.a.createElement(Bt,{post:t,thread:c,onExpandReply:d}),r.a.createElement(e,{thread:c,parent:t,expandedReplyId:m,replyBoxOpenForId:f,onExpandReply:d,onHide:i,onCollapseReply:u,onOpenReplyBox:p,onCloseReplyBox:b}))})))};var Mt=Object(V.a)({thread:{marginBottom:15},truncatedMessage:{color:"#fff",fontWeight:"bold",borderTop:"1px solid #656565",borderBottom:"1px dotted #fff",backgroundColor:"#181818",cursor:"pointer",marginTop:-3,"&:hover":{backgroundColor:"#282828"}},replyCount:{color:"#00bff3"},truncatedContainer:{height:300,overflow:"hidden",position:"relative"},truncatedComments:{position:"absolute !important",bottom:0}}),Ut=r.a.memo((function(e){var t=e.thread,n=Mt(),o=Object(a.useState)(null),c=Object(d.a)(o,2),s=c[0],l=c[1],i=Object(a.useState)(null),u=Object(d.a)(i,2),p=u[0],m=u[1],f=Object(a.useState)(t.markType),b=Object(d.a)(f,2),h=b[0],g=b[1],v=Object(a.useContext)(P),w=v.username,O=v.isLoggedIn,E=Object(a.useContext)(Ee).isPostVisible,j=Object(a.useState)(0),k=Object(d.a)(j,2),C=k[0],S=k[1],T=Object(a.useMemo)((function(){var e=t.posts?t.posts:[];e.slice(-10).reverse().forEach((function(e,t){return e.recentReplyNumber=t+1}));var n=Object(d.a)(e,1)[0];return Object($.a)({},t,{},n,{id:+t.threadId,posts:e,markType:h,revision:C})}),[t,h,C]),N=Object(a.useMemo)((function(){var e=T.posts.filter((function(e){return E(T,e)})).sort((function(e,t){return e.id-t.id})),t=e.reduce((function(e,t){return Object($.a)({},e,Object(Je.a)({},t.id,!!e[t.parentId]))}),{0:!0});return e.reduce((function(e,n){return e+(t[n.parentId]?1:0)}),0)-1}),[E,T]),I=Object(a.useState)(N>20),F=Object(d.a)(I,2),R=F[0],L=F[1],B=Object(a.useCallback)(function(){var e=Object(y.a)(x.a.mark((function e(t,n){var a;return x.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.markType=n,S(C+1),a=t.id||t.threadId,!O){e.next=12;break}return e.prev=4,e.next=7,ne("clientData/markPost",{method:"POST",body:{username:w,postId:a,type:n}});case 7:e.next=12;break;case 9:e.prev=9,e.t0=e.catch(4),console.error("Error marking post.",e.t0);case 12:case"end":return e.stop()}}),e,null,[[4,9]])})));return function(t,n){return e.apply(this,arguments)}}(),[O,C,w]),D=Object(a.useCallback)(function(){var e=Object(y.a)(x.a.mark((function e(t){return x.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:g(t),B(T,t);case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),[B,T]),M=Object(a.useCallback)((function(e){l(e),m(null),L(!1)}),[]),U=Object(a.useCallback)((function(){l(null),m(null)}),[]),z=Object(a.useCallback)((function(e){return m(e)}),[]),W=Object(a.useCallback)((function(){return m(null)}),[]),H=Object(a.useCallback)((function(e){return B(e,"collapsed"!==e.markType?"collapsed":"unmarked")}),[B]),_=Object(a.useCallback)((function(){return D("collapsed"!==T.markType?"collapsed":"unmarked")}),[D,T.markType]),V=Object(a.useCallback)((function(){return D("pinned"!==T.markType?"pinned":"unmarked")}),[D,T.markType]);return Object(a.useMemo)((function(){return E(T)}),[E,T])?r.a.createElement("div",{className:n.thread},r.a.createElement(Ft,{post:T,thread:T,replyBoxOpenForId:p,onCollapse:_,onOpenReplyBox:z,onCloseReplyBox:W,onPinned:V}),R&&r.a.createElement("div",{className:n.truncatedMessage,onClick:function(){return L(!1)}},"Thread truncated. Click to see all\xa0",r.a.createElement("span",{className:n.replyCount},N),"\xa0replies."),r.a.createElement("div",{className:R?n.truncatedContainer:null},r.a.createElement(Dt,{className:R?n.truncatedComments:null,thread:T,expandedReplyId:s,replyBoxOpenForId:p,onExpandReply:M,onHide:H,onCollapseReply:U,onOpenReplyBox:z,onCloseReplyBox:W}))):null}));var zt=Object(V.a)({chatty:{margin:"56px 8px 8px 8px",font:"12px/1.5 arial, helvetica, clean, sans-serif"}}),Wt=function(){var e=zt(),t=Object(a.useContext)(_).threads;return r.a.createElement("div",{className:e.chatty},t.map((function(e){return r.a.createElement(Ut,{key:e.threadId,thread:e})})))};var Ht=function(){return r.a.createElement(r.a.Fragment,null,r.a.createElement(Ve,null),r.a.createElement(u.c,null,r.a.createElement(u.a,{path:"/chatty",component:Wt}),r.a.createElement(u.a,{component:Wt})))};var _t=function(e){var t=e.children,n=Object(a.useContext)(N),o=n.setLoading,c=n.showSnackbar,s=Object(a.useState)((function(){try{var e=localStorage.getItem("auth")||"{}",t=JSON.parse(e)||{};return{username:t.username,password:t.password}}catch(n){return console.log("Invalid storage value: auth",n),localStorage.removeItem("auth"),{username:null,password:null}}})),l=Object(d.a)(s,2),i=l[0],u=l[1],p=Object(a.useCallback)(function(){var e=Object(y.a)(x.a.mark((function e(t,n){return x.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,o("async"),e.next=4,ne("verifyCredentials",{method:"POST",body:{username:t,password:n}});case 4:e.sent.isValid?(localStorage.setItem("auth",JSON.stringify({username:t,password:n})),u({username:t,password:n})):(console.log("Invalid login credentials."),c("Invalid username/password. Please check them and try again",{variant:"error"})),e.next=12;break;case 8:e.prev=8,e.t0=e.catch(0),console.log("Error while logging in",e.t0),c("Error while logging in. Please try again later.",{variant:"error"});case 12:return e.prev=12,o(!1),e.finish(12);case 15:case"end":return e.stop()}}),e,null,[[0,8,12,15]])})));return function(t,n){return e.apply(this,arguments)}}(),[o,c]),m=Object(a.useCallback)((function(){localStorage.removeItem("auth"),u({username:null,password:null})}),[]),f=i.username&&i.password,b=Object(a.useMemo)((function(){return Object($.a)({},i,{isLoggedIn:f,login:p,logout:m})}),[i,f,p,m]);return r.a.createElement(P.Provider,{value:b},t)},Vt=n(166),Jt=n(163);var At=function(e){var t=e.children,n=Object(a.useContext)(P),o=n.isLoggedIn,c=n.username,s=Object(a.useContext)(N),l=s.setLoading,i=s.showSnackbar,u=Object(a.useRef)({lastUsername:c,threads:[],newThreads:[]}),p=Object(a.useState)(u.current),m=Object(d.a)(p,2),f=m[0],b=m[1],h=Object(a.useState)(0),g=Object(d.a)(h,2),v=g[0],w=g[1],O=Object(a.useCallback)(Object(y.a)(x.a.mark((function e(){var t,n;return x.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!o){e.next=6;break}return e.next=3,ne("clientData/getMarkedPosts?username=".concat(encodeURIComponent(c)));case 3:return t=e.sent,n=t.markedPosts,e.abrupt("return",n);case 6:return e.abrupt("return",[]);case 7:case"end":return e.stop()}}),e)}))),[o,c]),E=Object(a.useCallback)(Object(y.a)(x.a.mark((function e(){var t,n,a,r,o,s,l,i,d,p,m,f=arguments;return x.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=f.length>0&&void 0!==f[0]&&f[0],n=f.length>1&&void 0!==f[1]&&f[1],a=f.length>2&&void 0!==f[2]&&f[2],!t){e.next=9;break}return e.next=6,j();case 6:e.t0=e.sent,e.next=10;break;case 9:e.t0={};case 10:if(r=e.t0,o=r.threads,!n){e.next=18;break}return e.next=15,O();case 15:e.t1=e.sent,e.next=19;break;case 18:e.t1=null;case 19:if(s=e.t1,o=o||u.current.threads,o=a?u.current.newThreads.concat(o):o,l=a?[]:u.current.newThreads,s&&(i=s.reduce((function(e,t){return Object($.a)({},e,Object(Je.a)({},t.id,t.type))}),{}),o=o.map((function(e){return Object($.a)({},Object($.a)({},e,{posts:e.posts.map((function(e){return Object($.a)({},e,{markType:i[e.id]||"unmarked"})}))}),{markType:i[e.threadId]||"unmarked"})}))),d=o.reduce((function(e,t){return e[t.threadId]=t.posts.reduce((function(e,t){return Math.max(t.id,e)}),0),e}),{}),p=Object(Vt.a)(Date.now(),18),o=(o=o.filter((function(e){var t=+e.threadId,n=e.posts.find((function(e){return e.id===t})),a=Object(at.a)(n.date);return Object(Jt.a)(p,a)}))).sort((function(e,t){return d[t.threadId]-d[e.threadId]})).sort((function(e,t){return"pinned"===e.markType?-1:"pinned"===t.markType?1:0})),u.current.threads=o,u.current.newThreads=l,s&&(m=s.filter((function(e){return!o.some((function(t){return t.posts.find((function(t){return t.id===e.id}))}))})).map((function(e){return e.id}))).length)try{m.reduce(function(){var e=Object(y.a)(x.a.mark((function e(t,n){return x.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t;case 2:return e.abrupt("return",ne("clientData/markPost",{method:"POST",body:{username:c,postId:n,type:"unmarked"}}));case 3:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),Promise.resolve())}catch(h){console.error("Error unmarking old posts.",h)}b(Object($.a)({},u.current));case 32:case"end":return e.stop()}}),e)}))),[O,c]),j=function(){var e=Object(y.a)(x.a.mark((function e(t){return x.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,ne("getChatty".concat(t>0?"?count=".concat(t):""));case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),k=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.eventType,n=e.eventData;if("newPost"===t){var a=n.post;if(a.parentId){var r=function(e){if(e.threadId===a.threadId&&!e.posts.find((function(e){return e.id===a.id})))return Object($.a)({},e,{posts:[].concat(Object(ut.a)(e.posts),[a])});return e};u.current.threads=u.current.threads.map(r),u.current.newThreads=u.current.newThreads.map(r)}else{var o=u.current.threads.find((function(e){return e.threadId===a.id}))||u.current.newThreads.find((function(e){return e.threadId===a.id}));o||(u.current.newThreads=[].concat(Object(ut.a)(u.current.newThreads),[{threadId:a.id,posts:[a]}]))}}else if("categoryChange"===t){var c=n.postId,s=n.category,l=function(e){if(e.posts.find((function(e){return e.id===c}))){var t=e.posts.map((function(e){return e.id===c?Object($.a)({},e,{category:s}):e}));return Object($.a)({},e,{posts:t})}return e};u.current.threads=u.current.threads.map(l),u.current.newThreads=u.current.newThreads.map(l)}else if("lolCountsUpdate"===t){var i=n.updates,d=i.reduce((function(e,t){var n=t.postId,a=t.tag,r=t.count;return Object($.a)({},e,Object(Je.a)({},n,{tag:a,count:r}))}),{}),p=function(e){if(e.posts.find((function(e){return d[e.id]}))){var t=e.posts.map((function(e){var t=d[e.id];if(t){var n=(e.lols||[]).filter((function(e){return e.tag!==t.tag})).concat([t]);return Object($.a)({},e,{lols:n})}return e}));return Object($.a)({},e,{posts:t})}return e};u.current.threads=u.current.threads.map(p),u.current.newThreads=u.current.newThreads.map(p)}else console.debug("Unhandled event type:",e)};Object(a.useEffect)((function(){var e=function(){var t=Object(y.a)(x.a.mark((function t(){var n,a;return x.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,l("async"),t.next=4,ne("getNewestEventId");case 4:return n=t.sent,a=n.eventId,t.next=8,E(!0,!0,!1);case 8:w(a),t.next=16;break;case 11:t.prev=11,t.t0=t.catch(0),i("Error loading chatty. Content may not be current.",{variant:"error"}),console.error("Exception while doing full reload.",t.t0),setTimeout((function(){return e()}),3e4);case 16:return t.prev=16,l(!1),t.finish(16);case 19:case"end":return t.stop()}}),t,null,[[0,11,16,19]])})));return function(){return t.apply(this,arguments)}}();0===v&&(u.current.threads=[],u.current.newThreads=[],e())}),[v]),Object(a.useEffect)((function(){var e=!0,t=function(){var n=Object(y.a)(x.a.mark((function n(){var a,r,o,c;return x.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(!e||!v){n.next=29;break}return n.prev=1,n.next=4,ne("waitForEvent?lastEventId=".concat(v));case 4:if(a=n.sent,r=a.lastEventId,o=a.events,c=a.error,!e){n.next=22;break}if(c){n.next=19;break}if(!(r>v)){n.next=16;break}o.forEach((function(e){return k(e)})),w(r),b(Object($.a)({},u.current)),n.next=17;break;case 16:return n.abrupt("return",t(v));case 17:n.next=22;break;case 19:console.error("Error from API:waitForLastEvent call.",c),i("Error receiving events. Reloading full chatty.",{variant:"error"}),w(0);case 22:n.next=29;break;case 24:n.prev=24,n.t0=n.catch(1),i("Error receiving events. Reloading full chatty.",{variant:"error"}),console.error("Exception from API:waitForLastEvent call.",n.t0),w(0);case 29:case"end":return n.stop()}}),n,null,[[1,24]])})));return function(){return n.apply(this,arguments)}}();return t(v),function(){return e=!1}}),[v]),Object(a.useEffect)((function(){var e=function(){var e=Object(y.a)(x.a.mark((function e(){return x.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return u.current.lastUsername=c,e.prev=1,l("async"),b({threads:[],newThreads:[]}),e.next=6,E(!0,!0,!0);case 6:return e.prev=6,l(!1),e.finish(6);case 9:case"end":return e.stop()}}),e,null,[[1,,6,9]])})));return function(){return e.apply(this,arguments)}}();c!==u.current.lastUsername&&e()}),[c,l,E]);var C=Object(a.useCallback)((function(){return E(!1,!1,!0)}),[E]),S=Object(a.useMemo)((function(){return Object($.a)({},f,{refreshChatty:C})}),[f,C]);return r.a.createElement(_.Provider,{value:S},t)},qt=(n(232),n(233),n(234),n(303));var Kt=Object(V.a)({progress:{zIndex:9999,position:"fixed",top:0,width:"100vw"}}),Gt=function(e){var t=e.loading,n=Kt();return"async"!==t?null:r.a.createElement(qt.a,{className:n.progress,color:"secondary"})},Qt=n(304);var Xt=Object(V.a)({container:{zIndex:99999,position:"fixed",top:0,left:0,bottom:0,right:0,backgroundColor:"rgba(0, 0, 0, 0.2)"},progress:{position:"absolute",top:"calc(50% - 60px)",left:"calc(50% - 60px)"}}),Yt=function(e){var t=e.loading,n=Xt();return"sync"!==t?null:r.a.createElement("div",{className:n.container},r.a.createElement(Qt.a,{className:n.progress,size:60,thickness:4,color:"secondary"}))},Zt=n(98);var $t=function(e){var t=e.children,n=Object(a.useState)(!1),o=Object(d.a)(n,2),c=o[0],s=o[1],l=Object(Zt.useSnackbar)().enqueueSnackbar,i=Object(a.useMemo)((function(){return{setLoading:s,showSnackbar:l}}),[l]);return r.a.createElement(N.Provider,{value:i},r.a.createElement(Yt,{loading:c}),r.a.createElement(Gt,{loading:c}),t)},en=r.a.createContext({});var tn={filteredTerms:[],filteredUsers:[],showCollapsed:!1,showFilteredTerms:!1,showNotWorkSafePosts:!0,showStupidPosts:!0,showOfftopicPosts:!0,showPoliticalReligiousPosts:!0,showCortexPosts:!0},nn=function(e){var t=e.children,n=Object(a.useContext)(en),o=n.clientData,c=n.updateClientData,s=Object(a.useState)(tn),l=Object(d.a)(s,2),i=l[0],u=l[1],p=Object(a.useContext)(N).showSnackbar,m=Object(a.useCallback)(function(){var e=Object(y.a)(x.a.mark((function e(t){return x.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,c("filterSettings",t);case 3:e.next=9;break;case 5:e.prev=5,e.t0=e.catch(0),console.error("Error updating clientData.filterSettings."),p("Error updating filter settings, changes may have been lost.",{variant:"error"});case 9:case"end":return e.stop()}}),e,null,[[0,5]])})));return function(t){return e.apply(this,arguments)}}(),[p,c]);Object(a.useEffect)((function(){try{if(o&&o.filterSettings){var e=o.filterSettings,t=function(t,n){return e.hasOwnProperty(t)&&e[t]||n};u({filteredTerms:t("filteredTerms",[]).map((function(e){return{text:e,regex:new RegExp(e,"mi")}})),filteredUsers:t("filteredUsers",[]).map((function(e){return{text:e,regex:new RegExp(e,"mi")}})),showCollapsed:!!t("showCollapsed",!1),showFilteredTerms:!!t("showFilteredTerms",!1),showFilteredUsers:!!t("showFilteredUsers",!1),showNotWorkSafePosts:!!t("showNotWorkSafePosts",!0),showStupidPosts:!!t("showStupidPosts",!0),showOfftopicPosts:!!t("showOfftopicPosts",!0),showPoliticalReligiousPosts:!!t("showPoliticalReligiousPosts",!0),showCortexPosts:!!t("showCortexPosts",!0)})}}catch(n){console.error("Error parsing clientData.filterSettings, resetting to default."),p("Error loading filter settings, resetting to default.",{variant:"error"}),m(tn),u(tn)}}),[o,p,m]);var f=Object(a.useCallback)((function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e,n=i.showCollapsed,a=i.showFilteredUsers,r=i.filteredUsers,o=i.showFilteredTerms,c=i.filteredTerms,s=i.showNotWorkSafePosts,l=i.showStupidPosts,u=i.showOfftopicPosts,d=i.showPoliticalReligiousPosts,p=i.showCortexPosts;return!(!n&&"collapsed"===e.markType)&&(!(!n&&"collapsed"===t.markType)&&(!(!a&&r.some((function(e){return e.regex.test(t.author)})))&&(!(!o&&c.some((function(e){return e.regex.test(Rt(t.body))})))&&(!(!s&&"nws"===t.category)&&(!(!l&&"stupid"===t.category)&&(!(!u&&"tangent"===t.category)&&(!(!d&&"political"===t.category)&&!(!p&&t.isCortex))))))))}),[i]),b=Object(a.useCallback)(function(){var e=Object(y.a)(x.a.mark((function e(t){var n,a;return x.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=Object($.a)({},i,{},t),a=Object($.a)({},n,{filteredTerms:n.filteredTerms.map((function(e){return e.text})),filteredUsers:n.filteredUsers.map((function(e){return e.text}))}),m(a),u(n);case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),[i,m]),h=Object(a.useMemo)((function(){return{filterSettings:i,updateFilterSettings:b,isPostVisible:f}}),[i,f,b]);return r.a.createElement(Ee.Provider,{value:h},t)},an=n(39).a({});var rn="nixxedchatty",on=function(e){var t=e.children,n=Object(a.useState)({}),o=Object(d.a)(n,2),c=o[0],s=o[1],l=Object(a.useContext)(P),i=l.isLoggedIn,u=l.username,p=Object(a.useContext)(N).showSnackbar,m=Object(a.useCallback)(function(){var e=Object(y.a)(x.a.mark((function e(t,n){var a,r,o,s;return x.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,a=Object($.a)({},c),t&&(a[t]=n),r=JSON.stringify(a),o={client:rn,username:encodeURIComponent(u),data:r},e.next=7,ne("clientData/setClientData",{method:"POST",body:o});case 7:(s=e.sent).error&&(p("Error updating user preferences.",{variant:"error"}),console.error("Error setting client data",s)),e.next=15;break;case 11:e.prev=11,e.t0=e.catch(0),p("Error updating user preferences.",{variant:"error"}),console.error("Error setting client data",e.t0);case 15:case"end":return e.stop()}}),e,null,[[0,11]])})));return function(t,n){return e.apply(this,arguments)}}(),[c,p,u]);Object(a.useEffect)((function(){(function(){var e=Object(y.a)(x.a.mark((function e(){var t,n,a,r;return x.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!i){e.next=18;break}return e.prev=1,t=te.a.stringify({client:rn,username:encodeURIComponent(u)}),e.next=5,ne("clientData/getClientData?".concat(t));case 5:n=e.sent,a=n.data,r=JSON.parse(a||"{}"),s(r),e.next=16;break;case 11:e.prev=11,e.t0=e.catch(1),p("Error loading user preferences.",{variant:"error"}),console.error("Error loading client data",e.t0),s({});case 16:e.next=19;break;case 18:s({});case 19:case"end":return e.stop()}}),e,null,[[1,11]])})));return function(){return e.apply(this,arguments)}})()()}),[i,p,u]);var f=Object(a.useMemo)((function(){return{clientData:c,updateClientData:m}}),[c,m]);return i&&!c?null:r.a.createElement(en.Provider,{value:f},t)};var cn;cn=function(){return r.a.createElement(u.b,{history:an},r.a.createElement(s.a,{theme:i},r.a.createElement(Zt.SnackbarProvider,null,r.a.createElement($t,null,r.a.createElement(_t,null,r.a.createElement(on,null,r.a.createElement(nn,null,r.a.createElement(At,null,r.a.createElement(Ht,null)))))))))},c.a.render(r.a.createElement(cn,null),document.getElementById("root"))}},[[191,1,2]]]);
//# sourceMappingURL=main.6357f1fb.chunk.js.map